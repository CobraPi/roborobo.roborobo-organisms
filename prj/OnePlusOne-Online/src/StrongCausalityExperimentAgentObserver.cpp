/*
 *  StrongCausalityExperimentAgentObserver.cpp
 *  roborobo
 *
 *  Created by Nicolas on 03/04/09.
 *  Copyright 2009 __MyCompanyName__. All rights reserved.
 *
 */

#include "OnePlusOne-Online/include/StrongCausalityExperimentAgentObserver.h"

#include "World/World.h"
#include "Utilities/Misc.h"

StrongCausalityExperimentAgentObserver::StrongCausalityExperimentAgentObserver( RobotAgentWorldModel *__wm )
{
	_wm = (EvolvingRobotAgentWorldModel*)__wm;
	_testIt = -1;
	_lifetimeIterations = 100; // 500
	
	_sigmaMin = 0.0001;
	_sigmaMax = 4; // 4;

	_minValue = -4; // -4
	_maxValue = +4; // +4
	
	_sigma = _sigmaMin;
	
	_triesPerSigma = 0;
	_nbOfTriesPerSigmaValue = 200; // 100


	//double initialGenome[18] = {-2.90695,3.45302,2.40923,0.792879,1.62175,-2.06755,-3.97888,-3.72544,-0.926573,3.03731,-0.0138294,-3.28417,2.29239,0.430691,-1.44229,-3.04593,2.05788,-2.05994};
	for ( int i = 0 ; i != 18 ; i++ )
	{
		double value = ranf()*8.-4.; // random initial genome (ext.run.2)
		//double value = initialGenome[i]; // pre-defined initial genome (ext.run.1)
		_storedGenome.push_back(value);
		_wm->_genome.push_back(value);
	}

	
	
	_wm->setNewGenomeStatus(true);
	
	_wm->_generation = 0;
	_wm->_fitnessValue = 0;
	_sumOfFitnesses = 0;
	_wm->_age = 0;	

//	reset();
	
}

StrongCausalityExperimentAgentObserver::~StrongCausalityExperimentAgentObserver()
{
	// nothing to do.
}


// 772 starting position (incl. 4 possible rotations)
static int initPos[][3] = 
{
  {50 , 50 , 0 } ,
  {50 , 50 , 90 } ,
  {50 , 50 , 180 } ,
  {50 , 50 , 270 } ,
  {100 , 50 , 0 } ,
  {100 , 50 , 90 } ,
  {100 , 50 , 180 } ,
  {100 , 50 , 270 } ,
  {150 , 50 , 0 } ,
  {150 , 50 , 90 } ,
  {150 , 50 , 180 } ,
  {150 , 50 , 270 } ,
  {200 , 50 , 0 } ,
  {200 , 50 , 90 } ,
  {200 , 50 , 180 } ,
  {200 , 50 , 270 } ,
  {250 , 50 , 0 } ,
  {250 , 50 , 90 } ,
  {250 , 50 , 180 } ,
  {250 , 50 , 270 } ,
  {300 , 50 , 0 } ,
  {300 , 50 , 90 } ,
  {300 , 50 , 180 } ,
  {300 , 50 , 270 } ,
  {350 , 50 , 0 } ,
  {350 , 50 , 90 } ,
  {350 , 50 , 180 } ,
  {350 , 50 , 270 } ,
  {400 , 50 , 0 } ,
  {400 , 50 , 90 } ,
  {400 , 50 , 180 } ,
  {400 , 50 , 270 } ,
  {450 , 50 , 0 } ,
  {450 , 50 , 90 } ,
  {450 , 50 , 180 } ,
  {450 , 50 , 270 } ,
  {500 , 50 , 0 } ,
  {500 , 50 , 90 } ,
  {500 , 50 , 180 } ,
  {500 , 50 , 270 } ,
  {550 , 50 , 0 } ,
  {550 , 50 , 90 } ,
  {550 , 50 , 180 } ,
  {550 , 50 , 270 } ,
  {600 , 50 , 0 } ,
  {600 , 50 , 90 } ,
  {600 , 50 , 180 } ,
  {600 , 50 , 270 } ,
  {650 , 50 , 0 } ,
  {650 , 50 , 90 } ,
  {650 , 50 , 180 } ,
  {650 , 50 , 270 } ,
  {700 , 50 , 0 } ,
  {700 , 50 , 90 } ,
  {700 , 50 , 180 } ,
  {700 , 50 , 270 } ,
  {750 , 50 , 0 } ,
  {750 , 50 , 90 } ,
  {750 , 50 , 180 } ,
  {750 , 50 , 270 } ,
  {50 , 100 , 0 } ,
  {50 , 100 , 90 } ,
  {50 , 100 , 180 } ,
  {50 , 100 , 270 } ,
  {100 , 100 , 0 } ,
  {100 , 100 , 90 } ,
  {100 , 100 , 180 } ,
  {100 , 100 , 270 } ,
  {150 , 100 , 0 } ,
  {150 , 100 , 90 } ,
  {150 , 100 , 180 } ,
  {150 , 100 , 270 } ,
  {200 , 100 , 0 } ,
  {200 , 100 , 90 } ,
  {200 , 100 , 180 } ,
  {200 , 100 , 270 } ,
  {250 , 100 , 0 } ,
  {250 , 100 , 90 } ,
  {250 , 100 , 180 } ,
  {250 , 100 , 270 } ,
  {300 , 100 , 0 } ,
  {300 , 100 , 90 } ,
  {300 , 100 , 180 } ,
  {300 , 100 , 270 } ,
  {350 , 100 , 0 } ,
  {350 , 100 , 90 } ,
  {350 , 100 , 180 } ,
  {350 , 100 , 270 } ,
  {400 , 100 , 0 } ,
  {400 , 100 , 90 } ,
  {400 , 100 , 180 } ,
  {400 , 100 , 270 } ,
  {450 , 100 , 0 } ,
  {450 , 100 , 90 } ,
  {450 , 100 , 180 } ,
  {450 , 100 , 270 } ,
  {500 , 100 , 0 } ,
  {500 , 100 , 90 } ,
  {500 , 100 , 180 } ,
  {500 , 100 , 270 } ,
  {550 , 100 , 0 } ,
  {550 , 100 , 90 } ,
  {550 , 100 , 180 } ,
  {550 , 100 , 270 } ,
  {600 , 100 , 0 } ,
  {600 , 100 , 90 } ,
  {600 , 100 , 180 } ,
  {600 , 100 , 270 } ,
  {650 , 100 , 0 } ,
  {650 , 100 , 90 } ,
  {650 , 100 , 180 } ,
  {650 , 100 , 270 } ,
  {700 , 100 , 0 } ,
  {700 , 100 , 90 } ,
  {700 , 100 , 180 } ,
  {700 , 100 , 270 } ,
  {750 , 100 , 0 } ,
  {750 , 100 , 90 } ,
  {750 , 100 , 180 } ,
  {750 , 100 , 270 } ,
  {50 , 150 , 0 } ,
  {50 , 150 , 90 } ,
  {50 , 150 , 180 } ,
  {50 , 150 , 270 } ,
  {100 , 150 , 0 } ,
  {100 , 150 , 90 } ,
  {100 , 150 , 180 } ,
  {100 , 150 , 270 } ,
  {150 , 150 , 0 } ,
  {150 , 150 , 90 } ,
  {150 , 150 , 180 } ,
  {150 , 150 , 270 } ,
  {200 , 150 , 0 } ,
  {200 , 150 , 90 } ,
  {200 , 150 , 180 } ,
  {200 , 150 , 270 } ,
  {250 , 150 , 0 } ,
  {250 , 150 , 90 } ,
  {250 , 150 , 180 } ,
  {250 , 150 , 270 } ,
  {300 , 150 , 0 } ,
  {300 , 150 , 90 } ,
  {300 , 150 , 180 } ,
  {300 , 150 , 270 } ,
  {350 , 150 , 0 } ,
  {350 , 150 , 90 } ,
  {350 , 150 , 180 } ,
  {350 , 150 , 270 } ,
  {400 , 150 , 0 } ,
  {400 , 150 , 90 } ,
  {400 , 150 , 180 } ,
  {400 , 150 , 270 } ,
  {450 , 150 , 0 } ,
  {450 , 150 , 90 } ,
  {450 , 150 , 180 } ,
  {450 , 150 , 270 } ,
  {500 , 150 , 0 } ,
  {500 , 150 , 90 } ,
  {500 , 150 , 180 } ,
  {500 , 150 , 270 } ,
  {550 , 150 , 0 } ,
  {550 , 150 , 90 } ,
  {550 , 150 , 180 } ,
  {550 , 150 , 270 } ,
  {600 , 150 , 0 } ,
  {600 , 150 , 90 } ,
  {600 , 150 , 180 } ,
  {600 , 150 , 270 } ,
  {650 , 150 , 0 } ,
  {650 , 150 , 90 } ,
  {650 , 150 , 180 } ,
  {650 , 150 , 270 } ,
  {700 , 150 , 0 } ,
  {700 , 150 , 90 } ,
  {700 , 150 , 180 } ,
  {700 , 150 , 270 } ,
  {750 , 150 , 0 } ,
  {750 , 150 , 90 } ,
  {750 , 150 , 180 } ,
  {750 , 150 , 270 } ,
  {50 , 200 , 0 } ,
  {50 , 200 , 90 } ,
  {50 , 200 , 180 } ,
  {50 , 200 , 270 } ,
  {100 , 200 , 0 } ,
  {100 , 200 , 90 } ,
  {100 , 200 , 180 } ,
  {100 , 200 , 270 } ,
  {150 , 200 , 0 } ,
  {150 , 200 , 90 } ,
  {150 , 200 , 180 } ,
  {150 , 200 , 270 } ,
  {200 , 200 , 0 } ,
  {200 , 200 , 90 } ,
  {200 , 200 , 180 } ,
  {200 , 200 , 270 } ,
//  {250 , 200 , 0 } ,
//  {250 , 200 , 90 } ,
//  {250 , 200 , 180 } ,
//  {250 , 200 , 270 } ,
//  {300 , 200 , 0 } ,
//  {300 , 200 , 90 } ,
//  {300 , 200 , 180 } ,
//  {300 , 200 , 270 } ,
//  {350 , 200 , 0 } ,
//  {350 , 200 , 90 } ,
//  {350 , 200 , 180 } ,
//  {350 , 200 , 270 } ,
//  {400 , 200 , 0 } ,
//  {400 , 200 , 90 } ,
//  {400 , 200 , 180 } ,
//  {400 , 200 , 270 } ,
  {450 , 200 , 0 } ,
  {450 , 200 , 90 } ,
  {450 , 200 , 180 } ,
  {450 , 200 , 270 } ,
  {500 , 200 , 0 } ,
  {500 , 200 , 90 } ,
  {500 , 200 , 180 } ,
  {500 , 200 , 270 } ,
  {550 , 200 , 0 } ,
  {550 , 200 , 90 } ,
  {550 , 200 , 180 } ,
  {550 , 200 , 270 } ,
  {600 , 200 , 0 } ,
  {600 , 200 , 90 } ,
  {600 , 200 , 180 } ,
  {600 , 200 , 270 } ,
  {650 , 200 , 0 } ,
  {650 , 200 , 90 } ,
  {650 , 200 , 180 } ,
  {650 , 200 , 270 } ,
  {700 , 200 , 0 } ,
  {700 , 200 , 90 } ,
  {700 , 200 , 180 } ,
  {700 , 200 , 270 } ,
  {750 , 200 , 0 } ,
  {750 , 200 , 90 } ,
  {750 , 200 , 180 } ,
  {750 , 200 , 270 } ,
  {50 , 250 , 0 } ,
  {50 , 250 , 90 } ,
  {50 , 250 , 180 } ,
  {50 , 250 , 270 } ,
  {100 , 250 , 0 } ,
  {100 , 250 , 90 } ,
  {100 , 250 , 180 } ,
  {100 , 250 , 270 } ,
  {150 , 250 , 0 } ,
  {150 , 250 , 90 } ,
  {150 , 250 , 180 } ,
  {150 , 250 , 270 } ,
  {200 , 250 , 0 } ,
  {200 , 250 , 90 } ,
  {200 , 250 , 180 } ,
  {200 , 250 , 270 } ,
//  {250 , 250 , 0 } ,
//  {250 , 250 , 90 } ,
//  {250 , 250 , 180 } ,
//  {250 , 250 , 270 } ,
//  {300 , 250 , 0 } ,
//  {300 , 250 , 90 } ,
//  {300 , 250 , 180 } ,
//  {300 , 250 , 270 } ,
//  {350 , 250 , 0 } ,
//  {350 , 250 , 90 } ,
//  {350 , 250 , 180 } ,
//  {350 , 250 , 270 } ,
//  {400 , 250 , 0 } ,
//  {400 , 250 , 90 } ,
//  {400 , 250 , 180 } ,
//  {400 , 250 , 270 } ,
  {450 , 250 , 0 } ,
  {450 , 250 , 90 } ,
  {450 , 250 , 180 } ,
  {450 , 250 , 270 } ,
  {500 , 250 , 0 } ,
  {500 , 250 , 90 } ,
  {500 , 250 , 180 } ,
  {500 , 250 , 270 } ,
  {550 , 250 , 0 } ,
  {550 , 250 , 90 } ,
  {550 , 250 , 180 } ,
  {550 , 250 , 270 } ,
//  {600 , 250 , 0 } ,
//  {600 , 250 , 90 } ,
//  {600 , 250 , 180 } ,
//  {600 , 250 , 270 } ,
//  {650 , 250 , 0 } ,
//  {650 , 250 , 90 } ,
//  {650 , 250 , 180 } ,
//  {650 , 250 , 270 } ,
//  {700 , 250 , 0 } ,
//  {700 , 250 , 90 } ,
//  {700 , 250 , 180 } ,
//  {700 , 250 , 270 } ,
//  {750 , 250 , 0 } ,
//  {750 , 250 , 90 } ,
//  {750 , 250 , 180 } ,
//  {750 , 250 , 270 } ,
  {50 , 300 , 0 } ,
  {50 , 300 , 90 } ,
  {50 , 300 , 180 } ,
  {50 , 300 , 270 } ,
  {100 , 300 , 0 } ,
  {100 , 300 , 90 } ,
  {100 , 300 , 180 } ,
  {100 , 300 , 270 } ,
  {150 , 300 , 0 } ,
  {150 , 300 , 90 } ,
  {150 , 300 , 180 } ,
  {150 , 300 , 270 } ,
  {200 , 300 , 0 } ,
  {200 , 300 , 90 } ,
  {200 , 300 , 180 } ,
  {200 , 300 , 270 } ,
//  {250 , 300 , 0 } ,
//  {250 , 300 , 90 } ,
//  {250 , 300 , 180 } ,
//  {250 , 300 , 270 } ,
//  {300 , 300 , 0 } ,
//  {300 , 300 , 90 } ,
//  {300 , 300 , 180 } ,
//  {300 , 300 , 270 } ,
//  {350 , 300 , 0 } ,
//  {350 , 300 , 90 } ,
//  {350 , 300 , 180 } ,
//  {350 , 300 , 270 } ,
//  {400 , 300 , 0 } ,
//  {400 , 300 , 90 } ,
//  {400 , 300 , 180 } ,
//  {400 , 300 , 270 } ,
  {450 , 300 , 0 } ,
  {450 , 300 , 90 } ,
  {450 , 300 , 180 } ,
  {450 , 300 , 270 } ,
  {500 , 300 , 0 } ,
  {500 , 300 , 90 } ,
  {500 , 300 , 180 } ,
  {500 , 300 , 270 } ,
  {550 , 300 , 0 } ,
  {550 , 300 , 90 } ,
  {550 , 300 , 180 } ,
  {550 , 300 , 270 } ,
  {600 , 300 , 0 } ,
  {600 , 300 , 90 } ,
  {600 , 300 , 180 } ,
  {600 , 300 , 270 } ,
  {650 , 300 , 0 } ,
  {650 , 300 , 90 } ,
  {650 , 300 , 180 } ,
  {650 , 300 , 270 } ,
  {700 , 300 , 0 } ,
  {700 , 300 , 90 } ,
  {700 , 300 , 180 } ,
  {700 , 300 , 270 } ,
  {750 , 300 , 0 } ,
  {750 , 300 , 90 } ,
  {750 , 300 , 180 } ,
  {750 , 300 , 270 } ,
  {50 , 350 , 0 } ,
  {50 , 350 , 90 } ,
  {50 , 350 , 180 } ,
  {50 , 350 , 270 } ,
  {100 , 350 , 0 } ,
  {100 , 350 , 90 } ,
  {100 , 350 , 180 } ,
  {100 , 350 , 270 } ,
  {150 , 350 , 0 } ,
  {150 , 350 , 90 } ,
  {150 , 350 , 180 } ,
  {150 , 350 , 270 } ,
  {200 , 350 , 0 } ,
  {200 , 350 , 90 } ,
  {200 , 350 , 180 } ,
  {200 , 350 , 270 } ,
  {250 , 350 , 0 } ,
  {250 , 350 , 90 } ,
  {250 , 350 , 180 } ,
  {250 , 350 , 270 } ,
  {300 , 350 , 0 } ,
  {300 , 350 , 90 } ,
  {300 , 350 , 180 } ,
  {300 , 350 , 270 } ,
  {350 , 350 , 0 } ,
  {350 , 350 , 90 } ,
  {350 , 350 , 180 } ,
  {350 , 350 , 270 } ,
  {400 , 350 , 0 } ,
  {400 , 350 , 90 } ,
  {400 , 350 , 180 } ,
  {400 , 350 , 270 } ,
  {450 , 350 , 0 } ,
  {450 , 350 , 90 } ,
  {450 , 350 , 180 } ,
  {450 , 350 , 270 } ,
  {500 , 350 , 0 } ,
  {500 , 350 , 90 } ,
  {500 , 350 , 180 } ,
  {500 , 350 , 270 } ,
  {550 , 350 , 0 } ,
  {550 , 350 , 90 } ,
  {550 , 350 , 180 } ,
  {550 , 350 , 270 } ,
  {600 , 350 , 0 } ,
  {600 , 350 , 90 } ,
  {600 , 350 , 180 } ,
  {600 , 350 , 270 } ,
  {650 , 350 , 0 } ,
  {650 , 350 , 90 } ,
  {650 , 350 , 180 } ,
  {650 , 350 , 270 } ,
  {700 , 350 , 0 } ,
  {700 , 350 , 90 } ,
  {700 , 350 , 180 } ,
  {700 , 350 , 270 } ,
  {750 , 350 , 0 } ,
  {750 , 350 , 90 } ,
  {750 , 350 , 180 } ,
  {750 , 350 , 270 } ,
  {50 , 400 , 0 } ,
  {50 , 400 , 90 } ,
  {50 , 400 , 180 } ,
  {50 , 400 , 270 } ,
  {100 , 400 , 0 } ,
  {100 , 400 , 90 } ,
  {100 , 400 , 180 } ,
  {100 , 400 , 270 } ,
  {150 , 400 , 0 } ,
  {150 , 400 , 90 } ,
  {150 , 400 , 180 } ,
  {150 , 400 , 270 } ,
  {200 , 400 , 0 } ,
  {200 , 400 , 90 } ,
  {200 , 400 , 180 } ,
  {200 , 400 , 270 } ,
  {250 , 400 , 0 } ,
  {250 , 400 , 90 } ,
  {250 , 400 , 180 } ,
  {250 , 400 , 270 } ,
  {300 , 400 , 0 } ,
  {300 , 400 , 90 } ,
  {300 , 400 , 180 } ,
  {300 , 400 , 270 } ,
  {350 , 400 , 0 } ,
  {350 , 400 , 90 } ,
  {350 , 400 , 180 } ,
  {350 , 400 , 270 } ,
  {400 , 400 , 0 } ,
  {400 , 400 , 90 } ,
  {400 , 400 , 180 } ,
  {400 , 400 , 270 } ,
  {450 , 400 , 0 } ,
  {450 , 400 , 90 } ,
  {450 , 400 , 180 } ,
  {450 , 400 , 270 } ,
  {500 , 400 , 0 } ,
  {500 , 400 , 90 } ,
  {500 , 400 , 180 } ,
  {500 , 400 , 270 } ,
  {550 , 400 , 0 } ,
  {550 , 400 , 90 } ,
  {550 , 400 , 180 } ,
  {550 , 400 , 270 } ,
  {600 , 400 , 0 } ,
  {600 , 400 , 90 } ,
  {600 , 400 , 180 } ,
  {600 , 400 , 270 } ,
  {650 , 400 , 0 } ,
  {650 , 400 , 90 } ,
  {650 , 400 , 180 } ,
  {650 , 400 , 270 } ,
  {700 , 400 , 0 } ,
  {700 , 400 , 90 } ,
  {700 , 400 , 180 } ,
  {700 , 400 , 270 } ,
  {750 , 400 , 0 } ,
  {750 , 400 , 90 } ,
  {750 , 400 , 180 } ,
  {750 , 400 , 270 } ,
  {50 , 450 , 0 } ,
  {50 , 450 , 90 } ,
  {50 , 450 , 180 } ,
  {50 , 450 , 270 } ,
  {100 , 450 , 0 } ,
  {100 , 450 , 90 } ,
  {100 , 450 , 180 } ,
  {100 , 450 , 270 } ,
  {150 , 450 , 0 } ,
  {150 , 450 , 90 } ,
  {150 , 450 , 180 } ,
  {150 , 450 , 270 } ,
  {200 , 450 , 0 } ,
  {200 , 450 , 90 } ,
  {200 , 450 , 180 } ,
  {200 , 450 , 270 } ,
  {250 , 450 , 0 } ,
  {250 , 450 , 90 } ,
  {250 , 450 , 180 } ,
  {250 , 450 , 270 } ,
  {300 , 450 , 0 } ,
  {300 , 450 , 90 } ,
  {300 , 450 , 180 } ,
  {300 , 450 , 270 } ,
  {350 , 450 , 0 } ,
  {350 , 450 , 90 } ,
  {350 , 450 , 180 } ,
  {350 , 450 , 270 } ,
  {400 , 450 , 0 } ,
  {400 , 450 , 90 } ,
  {400 , 450 , 180 } ,
  {400 , 450 , 270 } ,
  {450 , 450 , 0 } ,
  {450 , 450 , 90 } ,
  {450 , 450 , 180 } ,
  {450 , 450 , 270 } ,
  {500 , 450 , 0 } ,
  {500 , 450 , 90 } ,
  {500 , 450 , 180 } ,
  {500 , 450 , 270 } ,
  {550 , 450 , 0 } ,
  {550 , 450 , 90 } ,
  {550 , 450 , 180 } ,
  {550 , 450 , 270 } ,
  {600 , 450 , 0 } ,
  {600 , 450 , 90 } ,
  {600 , 450 , 180 } ,
  {600 , 450 , 270 } ,
  {650 , 450 , 0 } ,
  {650 , 450 , 90 } ,
  {650 , 450 , 180 } ,
  {650 , 450 , 270 } ,
  {700 , 450 , 0 } ,
  {700 , 450 , 90 } ,
  {700 , 450 , 180 } ,
  {700 , 450 , 270 } ,
  {750 , 450 , 0 } ,
  {750 , 450 , 90 } ,
  {750 , 450 , 180 } ,
  {750 , 450 , 270 } ,
//  {50 , 500 , 0 } ,
//  {50 , 500 , 90 } ,
//  {50 , 500 , 180 } ,
//  {50 , 500 , 270 } ,
//  {100 , 500 , 0 } ,
//  {100 , 500 , 90 } ,
//  {100 , 500 , 180 } ,
//  {100 , 500 , 270 } ,
//  {150 , 500 , 0 } ,
//  {150 , 500 , 90 } ,
//  {150 , 500 , 180 } ,
//  {150 , 500 , 270 } ,
//  {200 , 500 , 0 } ,
//  {200 , 500 , 90 } ,
//  {200 , 500 , 180 } ,
//  {200 , 500 , 270 } ,
  {250 , 500 , 0 } ,
  {250 , 500 , 90 } ,
  {250 , 500 , 180 } ,
  {250 , 500 , 270 } ,
  {300 , 500 , 0 } ,
  {300 , 500 , 90 } ,
  {300 , 500 , 180 } ,
  {300 , 500 , 270 } ,
  {350 , 500 , 0 } ,
  {350 , 500 , 90 } ,
  {350 , 500 , 180 } ,
  {350 , 500 , 270 } ,
  {400 , 500 , 0 } ,
  {400 , 500 , 90 } ,
  {400 , 500 , 180 } ,
  {400 , 500 , 270 } ,
  {450 , 500 , 0 } ,
  {450 , 500 , 90 } ,
  {450 , 500 , 180 } ,
  {450 , 500 , 270 } ,
  {500 , 500 , 0 } ,
  {500 , 500 , 90 } ,
  {500 , 500 , 180 } ,
  {500 , 500 , 270 } ,
  {550 , 500 , 0 } ,
  {550 , 500 , 90 } ,
  {550 , 500 , 180 } ,
  {550 , 500 , 270 } ,
  {600 , 500 , 0 } ,
  {600 , 500 , 90 } ,
  {600 , 500 , 180 } ,
  {600 , 500 , 270 } ,
  {650 , 500 , 0 } ,
  {650 , 500 , 90 } ,
  {650 , 500 , 180 } ,
  {650 , 500 , 270 } ,
  {700 , 500 , 0 } ,
  {700 , 500 , 90 } ,
  {700 , 500 , 180 } ,
  {700 , 500 , 270 } ,
  {750 , 500 , 0 } ,
  {750 , 500 , 90 } ,
  {750 , 500 , 180 } ,
  {750 , 500 , 270 } ,
  {50 , 550 , 0 } ,
  {50 , 550 , 90 } ,
  {50 , 550 , 180 } ,
  {50 , 550 , 270 } ,
  {100 , 550 , 0 } ,
  {100 , 550 , 90 } ,
  {100 , 550 , 180 } ,
  {100 , 550 , 270 } ,
  {150 , 550 , 0 } ,
  {150 , 550 , 90 } ,
  {150 , 550 , 180 } ,
  {150 , 550 , 270 } ,
  {200 , 550 , 0 } ,
  {200 , 550 , 90 } ,
  {200 , 550 , 180 } ,
  {200 , 550 , 270 } ,
  {250 , 550 , 0 } ,
  {250 , 550 , 90 } ,
  {250 , 550 , 180 } ,
  {250 , 550 , 270 } ,
  {300 , 550 , 0 } ,
  {300 , 550 , 90 } ,
  {300 , 550 , 180 } ,
  {300 , 550 , 270 } ,
  {350 , 550 , 0 } ,
  {350 , 550 , 90 } ,
  {350 , 550 , 180 } ,
  {350 , 550 , 270 } ,
  {400 , 550 , 0 } ,
  {400 , 550 , 90 } ,
  {400 , 550 , 180 } ,
  {400 , 550 , 270 } ,
//  {450 , 550 , 0 } ,
//  {450 , 550 , 90 } ,
//  {450 , 550 , 180 } ,
//  {450 , 550 , 270 } ,
//  {500 , 550 , 0 } ,
//  {500 , 550 , 90 } ,
//  {500 , 550 , 180 } ,
//  {500 , 550 , 270 } ,
//  {550 , 550 , 0 } ,
//  {550 , 550 , 90 } ,
//  {550 , 550 , 180 } ,
//  {550 , 550 , 270 } ,
//  {600 , 550 , 0 } ,
//  {600 , 550 , 90 } ,
//  {600 , 550 , 180 } ,
//  {600 , 550 , 270 } ,
  {650 , 550 , 0 } ,
  {650 , 550 , 90 } ,
  {650 , 550 , 180 } ,
  {650 , 550 , 270 } ,
  {700 , 550 , 0 } ,
  {700 , 550 , 90 } ,
  {700 , 550 , 180 } ,
  {700 , 550 , 270 } ,
  {750 , 550 , 0 } ,
  {750 , 550 , 90 } ,
  {750 , 550 , 180 } ,
  {750 , 550 , 270 } ,
  {50 , 600 , 0 } ,
  {50 , 600 , 90 } ,
  {50 , 600 , 180 } ,
  {50 , 600 , 270 } ,
  {100 , 600 , 0 } ,
  {100 , 600 , 90 } ,
  {100 , 600 , 180 } ,
  {100 , 600 , 270 } ,
  {150 , 600 , 0 } ,
  {150 , 600 , 90 } ,
  {150 , 600 , 180 } ,
  {150 , 600 , 270 } ,
  {200 , 600 , 0 } ,
  {200 , 600 , 90 } ,
  {200 , 600 , 180 } ,
  {200 , 600 , 270 } ,
  {250 , 600 , 0 } ,
  {250 , 600 , 90 } ,
  {250 , 600 , 180 } ,
  {250 , 600 , 270 } ,
  {300 , 600 , 0 } ,
  {300 , 600 , 90 } ,
  {300 , 600 , 180 } ,
  {300 , 600 , 270 } ,
  {350 , 600 , 0 } ,
  {350 , 600 , 90 } ,
  {350 , 600 , 180 } ,
  {350 , 600 , 270 } ,
  {400 , 600 , 0 } ,
  {400 , 600 , 90 } ,
  {400 , 600 , 180 } ,
  {400 , 600 , 270 } ,
//  {450 , 600 , 0 } ,
//  {450 , 600 , 90 } ,
//  {450 , 600 , 180 } ,
//  {450 , 600 , 270 } ,
//  {500 , 600 , 0 } ,
//  {500 , 600 , 90 } ,
//  {500 , 600 , 180 } ,
//  {500 , 600 , 270 } ,
//  {550 , 600 , 0 } ,
//  {550 , 600 , 90 } ,
//  {550 , 600 , 180 } ,
//  {550 , 600 , 270 } ,
//  {600 , 600 , 0 } ,
//  {600 , 600 , 90 } ,
//  {600 , 600 , 180 } ,
//  {600 , 600 , 270 } ,
  {650 , 600 , 0 } ,
  {650 , 600 , 90 } ,
  {650 , 600 , 180 } ,
  {650 , 600 , 270 } ,
  {700 , 600 , 0 } ,
  {700 , 600 , 90 } ,
  {700 , 600 , 180 } ,
  {700 , 600 , 270 } ,
  {750 , 600 , 0 } ,
  {750 , 600 , 90 } ,
  {750 , 600 , 180 } ,
  {750 , 600 , 270 } ,
  {50 , 650 , 0 } ,
  {50 , 650 , 90 } ,
  {50 , 650 , 180 } ,
  {50 , 650 , 270 } ,
  {100 , 650 , 0 } ,
  {100 , 650 , 90 } ,
  {100 , 650 , 180 } ,
  {100 , 650 , 270 } ,
  {150 , 650 , 0 } ,
  {150 , 650 , 90 } ,
  {150 , 650 , 180 } ,
  {150 , 650 , 270 } ,
  {200 , 650 , 0 } ,
  {200 , 650 , 90 } ,
  {200 , 650 , 180 } ,
  {200 , 650 , 270 } ,
  {250 , 650 , 0 } ,
  {250 , 650 , 90 } ,
  {250 , 650 , 180 } ,
  {250 , 650 , 270 } ,
  {300 , 650 , 0 } ,
  {300 , 650 , 90 } ,
  {300 , 650 , 180 } ,
  {300 , 650 , 270 } ,
  {350 , 650 , 0 } ,
  {350 , 650 , 90 } ,
  {350 , 650 , 180 } ,
  {350 , 650 , 270 } ,
  {400 , 650 , 0 } ,
  {400 , 650 , 90 } ,
  {400 , 650 , 180 } ,
  {400 , 650 , 270 } ,
//  {450 , 650 , 0 } ,
//  {450 , 650 , 90 } ,
//  {450 , 650 , 180 } ,
//  {450 , 650 , 270 } ,
//  {500 , 650 , 0 } ,
//  {500 , 650 , 90 } ,
//  {500 , 650 , 180 } ,
//  {500 , 650 , 270 } ,
//  {550 , 650 , 0 } ,
//  {550 , 650 , 90 } ,
//  {550 , 650 , 180 } ,
//  {550 , 650 , 270 } ,
//  {600 , 650 , 0 } ,
//  {600 , 650 , 90 } ,
//  {600 , 650 , 180 } ,
//  {600 , 650 , 270 } ,
  {650 , 650 , 0 } ,
  {650 , 650 , 90 } ,
  {650 , 650 , 180 } ,
  {650 , 650 , 270 } ,
  {700 , 650 , 0 } ,
  {700 , 650 , 90 } ,
  {700 , 650 , 180 } ,
  {700 , 650 , 270 } ,
  {750 , 650 , 0 } ,
  {750 , 650 , 90 } ,
  {750 , 650 , 180 } ,
  {750 , 650 , 270 } ,
  {50 , 700 , 0 } ,
  {50 , 700 , 90 } ,
  {50 , 700 , 180 } ,
  {50 , 700 , 270 } ,
  {100 , 700 , 0 } ,
  {100 , 700 , 90 } ,
  {100 , 700 , 180 } ,
  {100 , 700 , 270 } ,
  {150 , 700 , 0 } ,
  {150 , 700 , 90 } ,
  {150 , 700 , 180 } ,
  {150 , 700 , 270 } ,
  {200 , 700 , 0 } ,
  {200 , 700 , 90 } ,
  {200 , 700 , 180 } ,
  {200 , 700 , 270 } ,
  {250 , 700 , 0 } ,
  {250 , 700 , 90 } ,
  {250 , 700 , 180 } ,
  {250 , 700 , 270 } ,
  {300 , 700 , 0 } ,
  {300 , 700 , 90 } ,
  {300 , 700 , 180 } ,
  {300 , 700 , 270 } ,
  {350 , 700 , 0 } ,
  {350 , 700 , 90 } ,
  {350 , 700 , 180 } ,
  {350 , 700 , 270 } ,
  {400 , 700 , 0 } ,
  {400 , 700 , 90 } ,
  {400 , 700 , 180 } ,
  {400 , 700 , 270 } ,
  {450 , 700 , 0 } ,
  {450 , 700 , 90 } ,
  {450 , 700 , 180 } ,
  {450 , 700 , 270 } ,
  {500 , 700 , 0 } ,
  {500 , 700 , 90 } ,
  {500 , 700 , 180 } ,
  {500 , 700 , 270 } ,
  {550 , 700 , 0 } ,
  {550 , 700 , 90 } ,
  {550 , 700 , 180 } ,
  {550 , 700 , 270 } ,
  {600 , 700 , 0 } ,
  {600 , 700 , 90 } ,
  {600 , 700 , 180 } ,
  {600 , 700 , 270 } ,
  {650 , 700 , 0 } ,
  {650 , 700 , 90 } ,
  {650 , 700 , 180 } ,
  {650 , 700 , 270 } ,
  {700 , 700 , 0 } ,
  {700 , 700 , 90 } ,
  {700 , 700 , 180 } ,
  {700 , 700 , 270 } ,
  {750 , 700 , 0 } ,
  {750 , 700 , 90 } ,
  {750 , 700 , 180 } ,
  {750 , 700 , 270 } ,
  {50 , 750 , 0 } ,
  {50 , 750 , 90 } ,
  {50 , 750 , 180 } ,
  {50 , 750 , 270 } ,
  {100 , 750 , 0 } ,
  {100 , 750 , 90 } ,
  {100 , 750 , 180 } ,
  {100 , 750 , 270 } ,
  {150 , 750 , 0 } ,
  {150 , 750 , 90 } ,
  {150 , 750 , 180 } ,
  {150 , 750 , 270 } ,
  {200 , 750 , 0 } ,
  {200 , 750 , 90 } ,
  {200 , 750 , 180 } ,
  {200 , 750 , 270 } ,
  {250 , 750 , 0 } ,
  {250 , 750 , 90 } ,
  {250 , 750 , 180 } ,
  {250 , 750 , 270 } ,
  {300 , 750 , 0 } ,
  {300 , 750 , 90 } ,
  {300 , 750 , 180 } ,
  {300 , 750 , 270 } ,
  {350 , 750 , 0 } ,
  {350 , 750 , 90 } ,
  {350 , 750 , 180 } ,
  {350 , 750 , 270 } ,
  {400 , 750 , 0 } ,
  {400 , 750 , 90 } ,
  {400 , 750 , 180 } ,
  {400 , 750 , 270 } ,
  {450 , 750 , 0 } ,
  {450 , 750 , 90 } ,
  {450 , 750 , 180 } ,
  {450 , 750 , 270 } ,
  {500 , 750 , 0 } ,
  {500 , 750 , 90 } ,
  {500 , 750 , 180 } ,
  {500 , 750 , 270 } ,
  {550 , 750 , 0 } ,
  {550 , 750 , 90 } ,
  {550 , 750 , 180 } ,
  {550 , 750 , 270 } ,
  {600 , 750 , 0 } ,
  {600 , 750 , 90 } ,
  {600 , 750 , 180 } ,
  {600 , 750 , 270 } ,
  {650 , 750 , 0 } ,
  {650 , 750 , 90 } ,
  {650 , 750 , 180 } ,
  {650 , 750 , 270 } ,
  {700 , 750 , 0 } ,
  {700 , 750 , 90 } ,
  {700 , 750 , 180 } ,
  {700 , 750 , 270 } ,
  {750 , 750 , 0 } ,
  {750 , 750 , 90 } ,
  {750 , 750 , 180 } ,
  {750 , 750 , 270 } ,
  { -1, -1, -1 },
};



void StrongCausalityExperimentAgentObserver::reset() 
{ 
	// general 
	_testIt++;	
	
	_wm->_xReal = initPos[_wm->_generation][0];
	_wm->_yReal = initPos[_wm->_generation][1];
	_wm->_agentAbsoluteOrientation = initPos[_wm->_generation][2];
	_wm->_agentAbsoluteLinearSpeed = 0;

	_sumOfFitnesses = 0;

	_wm->_fitnessValue = 0;
	_wm->_age = 0;	
}

void StrongCausalityExperimentAgentObserver::step() 
{

	if ( _wm->_age == _lifetimeIterations )
	{			
		// stats for current agent
		_sumOfFitnesses = _sumOfFitnesses + _wm->_fitnessValue;
		
		if ( initPos[_wm->_generation][0] == -1 )  // genome iteration ends? display stats and restart with new genome
		{
			// * Display stats.
			
			//std::cout << _wm->_generation << "," << _wm->_fitnessValue;

			if ( _testIt == 0 )	// reference genome
				std::cout << "# ";
			std::cout << _testIt << "," << _sumOfFitnesses;

			if ( _testIt == 0 )	// reference genome
				std::cout << ",0";
			else
				std::cout << "," << _sigma;
			
			for ( int i = 0 ; i != 18 ; i++ ) // genome
			{
				std::cout << ",";
				std::cout << _wm->_genome[i];
				
			}
			std::cout << std::endl;
			
			reset();
			
			if ( _triesPerSigma == _nbOfTriesPerSigmaValue )
			{			
				if ( _sigma < _sigmaMax )
				{
					_sigma = _sigma * 2;
				}
				else
				{
					std::cout << "end." << std::endl;
					exit(0);
				}
				_triesPerSigma = 0;
			}
			else
				_triesPerSigma++;
			
			mutateWithBouncingBounds();

			_wm->_generation = 0;			
		}
		
		// prepare for new evaluation
		_wm->_generation++;

		_wm->_xReal = initPos[_wm->_generation][0];
		_wm->_yReal = initPos[_wm->_generation][1];
		_wm->_agentAbsoluteOrientation = initPos[_wm->_generation][2];
		_wm->_agentAbsoluteLinearSpeed = 0;
		
		_wm->_fitnessValue = 0;
		_wm->_age = 0; // age<0 means random mouvement until age=0D
		
	}	
	else
	{
		// udpate fitness
		updateFitness();
		_wm->_age++;
	}
}

void StrongCausalityExperimentAgentObserver::updateFitness()
{
	// * fitness: nolfi's book classical fitness
	
	double minimumCurrentSensorValue = INFINITY;
	double maximumPossibleSensorValue = 0;
/*
	for ( int i = 0 ; i != _wm->_sensorCount ; i++ )
	{
		if ( _wm->getSensorDistanceValue(i) < minimumCurrentSensorValue )
			minimumCurrentSensorValue = _wm->getSensorDistanceValue(i);
		if ( _wm->getSensorMaximumDistanceValue(i) > maximumPossibleSensorValue )
			maximumPossibleSensorValue = _wm->getSensorMaximumDistanceValue(i);
	}
*/
	// compute actual translation and rotation using speed sensor (ie. simulate odometry)
	double trans = _wm->_actualTranslationalValue < 0 ? -_wm->_actualTranslationalValue : _wm->_actualTranslationalValue;
	double rot = _wm->_actualRotationalVelocity < 0 ? -_wm->_actualRotationalVelocity : _wm->_actualRotationalVelocity;
	double instantFitness =
		( trans / gMaxTranslationalSpeed )
		* ( ( _wm->_maxRotationalDeltaValue - rot ) / _wm->_maxRotationalDeltaValue )
		* ( minimumCurrentSensorValue / maximumPossibleSensorValue );
		// trans * ( _rotationalMaxDeltaValue - rot ) * minimumCurrentSensorValue;
	_wm->_fitnessValue += instantFitness;

	if ( std::isnan((float)_wm->_fitnessValue) )
	//if ( _wm->_agentId == 1 && _wm->_age%500 == 499 )
	{
		std::cout 
			<< "CRITICAL: fitness value is not a number -- dump info:\n"	
			<< "Instant fitness value = " << instantFitness << "\n"
			<< "Total   fitness value = " << _wm->_fitnessValue << "\n"
			<< "trans: \t\t" << trans << "\t(" << ( trans / gMaxTranslationalSpeed ) <<")\n"
			<< "rot: \t\t\t" << _wm->_actualRotationalVelocity << "\t(" <<  ( ( _wm->_maxRotationalDeltaValue - rot ) / _wm->_maxRotationalDeltaValue )  << ")\n"
			<< "minsensor: \t" <<  minimumCurrentSensorValue << "\t(" << ( minimumCurrentSensorValue / maximumPossibleSensorValue )  << ")" << std::endl; // dont forget that translation delta value is given with tanh (-1 and +1 are common value)
		std::cout << "NN weights: ";
		//for ( int i = 0 ; i != _wm->_sensorCount*2+2 ; i++ )
		//	std::cout << _wm->_genome[i] << " , ";
		//std::cout << std::endl;

	//	exit (-1);
	}	


}




void StrongCausalityExperimentAgentObserver::mutateWithBouncingBounds()
{
	_wm->_genome.clear();
	for ( int i = 0 ; i != 18 ; i++ )
	{
		double value = _storedGenome[i] + getGaussianRand(0,_sigma);

		// bouncing upper/lower bounds
		if ( value < _minValue )
		{
			double range = _maxValue - _minValue;
			double overflow = - ( (double)value - _minValue );
			overflow = overflow - 2*range * (int)( overflow / (2*range) );
			if ( overflow < range )
				value = _minValue + overflow;
			else // overflow btw range and range*2
				value = _minValue + range - (overflow-range);
		}
		else
			if ( value > _maxValue )
			{
				double range = _maxValue - _minValue;
				double overflow = (double)value - _maxValue;
				overflow = overflow - 2*range * (int)( overflow / (2*range) );
				if ( overflow < range )
					value = _maxValue - overflow;
				else // overflow btw range and range*2
					value = _maxValue - range + (overflow-range);
			}

		_wm->_genome.push_back(value);
	}
	_wm->setNewGenomeStatus(true);
}

